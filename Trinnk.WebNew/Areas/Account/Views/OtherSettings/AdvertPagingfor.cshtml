@model SearchModel<NeoSistem.Trinnk.Web.Areas.Account.Models.Advert.MTProductItem>
@using NeoSistem.Trinnk.Web.Areas.Account.Models
@using NeoSistem.Trinnk.Web.Models

@using NeoSistem.Trinnk.Core.Web.Helpers
@using NeoSistem.Trinnk.Web.Helpers
@using System.Diagnostics
@using NeoSistem.Trinnk.Web.Models.Home
@using NeoSistem.Trinnk.Web.Models.MemberShip
@using NeoSistem.Trinnk.Web.Models.Authentication
@using Trinnk.Entities.Tables.Members
@using NeoSistem.Trinnk.Web.Models.ViewModels
@using NeoSistem.Trinnk.Web.Models.Products
@using NeoSistem.Trinnk.Web.Models.Catalog
@using NeoSistem.Trinnk.Web.Models.Entities
@using NeoSistem.Trinnk.Web.Models.ProductRequests
@using NeoSistem.Trinnk.Web.Models.Stores
@using NeoSistem.Trinnk.Core.Web
@using NeoSistem.Trinnk.Web.Models.StoreNews
@using System.Globalization
@using NeoSistem.Trinnk.Web.Models.StoreProfiles
@using NeoSistem.Trinnk.Web.Models.Videos
@using NeoSistem.Trinnk.Web.Models.Adverts
@using Trinnk.Entities.Tables.Catalog
@using NeoSistem.Trinnk.Web.Areas.Account.Models.Advert
@using NeoSistem.Trinnk.Web.Areas.Account.Models.FavoriteProducts
@using NeoSistem.Trinnk.Web.Areas.Account.Models.Checkouts

@{
    //Layout = "~/Views/Shared/_LayoutAccountMaster.cshtml";
    //Layout = "~/Views/Shared/_LayoutMainMaster.cshtml";
    //Layout = "~/Views/Shared/_LayoutStoreProfileMaster.cshtml";
    Layout = null;
}

<style type="text/css">
    .clearable {
        position: relative;
        display: inline-block;
    }

        .clearable input[type=text] {
            padding-right: 24px;
            width: 100%;
            box-sizing: border-box;
        }

    .clearable__clear {
        display: none;
        position: absolute;
        right: 0;
        top: 0;
        padding: 0 8px;
        font-style: normal;
        font-size: 1.2em;
        user-select: none;
        cursor: pointer;
    }

    .clearable input::-ms-clear { /* Remove IE default X */
        display: none;
    }
</style>
<script type="text/javascript">
    $(document).ready(function () {
        $(".clearable").each(function () {

            var $inp = $(this).find("input:text"),
                $cle = $(this).find(".clearable__clear");

            $inp.on("input", function () {
                $cle.toggle(!!this.value);
            });

            $cle.on("touchstart click", function (e) {
                e.preventDefault();
                $inp.val("").trigger("input");
            });

        });
        $('.searchText').on('keypress', function (e) {
            if (e.which === 13) {
                var currentPage = $("#CurrentPage").val();

                PageChangeOtherSettings(currentPage, 2, 1);


            }
        });
    });


    function PageChangeOtherSettings(p, d, a) {
        $(".loading").show();
        $.ajax({
            url: '/Account/OtherSettings/AdvertPagingfor',
            type: 'post',
            data: {
                page: p, displayType: d, advertListType: 7, ProductActiveType: a,
                productNo: $("#ProductNo").val(),
                productName: $("#ProductName").val(),
                categoryName: $("#CategoryName").val(),
                brandName: $("#BrandName").val(),
                modelName: $("#ModelName").val()
            },
            success: function (data) {
                $(".loading").hide();
                $('#Advert').html(data);
            }
        });
    }
</script>
@Html.HiddenFor(x => x.CurrentPage)
<div class="loading">Loading&#8230;</div>
<table class="table table-hover table-condensed">
    <thead>
        <tr>
            <th style="width: 100px">
                Ürün No
            </th>
            <th>
                Ürün Adı
            </th>
            <th>Kategori</th>
            <th>Marka</th>
            <th>Model</th>
            <th>Fiyatı</th>
            <th></th>
        </tr>
        <tr>
            <td>
                <span class="clearable">
                    <input class="searchText  form-control" id="ProductNo" type="text" value="#" />
                    <i class="clearable__clear">&times;</i>
                </span>
            </td>
            <td>
                <span class="clearable">
                    <input class="searchText form-control" type="text" id="ProductName" placeholder="Ürün Adı" />
                    <i class="clearable__clear">&times;</i>
                </span>
            </td>

            <td>
                <span class="clearable">
                    <input class="searchText  form-control" type="text" id="CategoryName" placeholder="Kategori.." />
                    <i class="clearable__clear">&times;</i>
                </span>
            </td>
            <td>
                <span class="clearable">
                    <input class="searchText  form-control" type="text" id="BrandName" placeholder="Marka.." />
                    <i class="clearable__clear">&times;</i>
                </span>
            </td>
            <td>
                <span class="clearable">
                    <input class="searchText  form-control" type="text" id="ModelName" placeholder="Model.." />
                    <i class="clearable__clear">&times;</i>
                </span>
            </td>
            <td></td>
            <td></td>
        </tr>
    </thead>
    <tbody>

        @foreach (var count in Model.Source)
        {

            string productUrl = Helpers.ProductUrl(count.ProductId, count.ProductName);
            <tr>
                <td>
                    <a href="@productUrl">
                        @count.ProductNo
                    </a>
                </td>
                <td>
                    <a href="@productUrl">
                        @Helpers.Truncate(count.ProductName, 100)
                    </a>
                </td>
                <td>
                    @count.CategoryName
                </td>
                <td>
                    @count.BrandName
                </td>
                <td>@count.ModelName</td>
                <td>
                    @if (count.ProductPriceType == 238)
                    {
                        <div id="priceEditWrapper@(count.ProductId )" style="display: none;">
                            @{string productPrice = count.ProductPriceDecimal.Value.ToString("N2"); }
                            @if (count.ProductPriceWithDiscountDecimal != 0)
                            {
                                productPrice = count.ProductPriceWithDiscountDecimal.Value.ToString("N2");

                            }

                            @Html.TextBox("editPriceValue", productPrice, new { @id = "editPriceValue" + count.ProductId, @class = "form-control" })

                            <button type="button" class="btn btn-info" onclick="PriceEditClick(@count.ProductId)">Kaydet</button>
                            <button type="button" class="btn btn-info" onclick="PriceEditCancel(@count.ProductId)">İptal</button>
                        </div>
                        <div id="priceDisplay@(count.ProductId )">
                            <span id="priceDisplayValue@(count.ProductId )" style="width: 50px!important;">
                                @if (!string.IsNullOrEmpty(count.ProductPriceWithDiscount))
                                {


                                    <span style="text-decoration: line-through;">@count.ProductPrice</span>
                                    @count.ProductPriceWithDiscount

                                }
                                else
                                {
                                    @count.ProductPrice

                                }
                                <i class="@count.CurrencyCssText"></i>
                                @if (count.IsKdv)
                                {
                                    @("Kdv Dahil")
                                }
                                else
                                {
                                    @("Kdv Hariç")
                                }

                            </span>

                            <a href="#" onclick="PriceEditShow(@count.ProductId)" class="btn btn-xs btn-default"><span class="glyphicon glyphicon-pencil"></span></a>

                        </div>

                    }
                    else
                    {

                        <span>@count.ProductPrice</span>
                        <a href="/Account/advert/Edit/@count.ProductId" target="_blank" class="btn btn-xs btn-default"><span class="glyphicon glyphicon-pencil"></span></a>
                    }

                </td>
                <td>
                    <a href="/Account/ilan/edit/@count.ProductId" class="btn btn-xs btn-default"><span class="glyphicon glyphicon-eye-open"></span>&nbsp;Düzenle </a>
                </td>
            </tr>

        }

    </tbody>
</table>

<hr>
<div class="row">
    @{ int pageCount = Model.TotalLinkPages.Count();
    }
    <div class="col-md-6 ">
        Toplam
        @pageCount
        sayfa içerisinde
        @Model.CurrentPage . sayfayı görmektesiniz.
    </div>
    <div class="col-md-6 text-right">
        <ul class="pagination m0">
            <li><a onclick="PageChangeOtherSettings(1,2,1);" href="#">&laquo; </a></li>
            @foreach (var item in Model.TotalLinkPages)
            {
                if (Model.CurrentPage == item)
                {
                    <li class="active">
                        <a href="#">
                            @item
                        </a>
                    </li>
                }
                else
                {
                    <li>
                        <a onclick="PageChangeOtherSettings(@item,2,1);">@item</a>
                    </li>
                }
            }
            <li><a onclick="PageChangeOtherSettings(@pageCount,2,1);">&raquo; </a></li>
        </ul>
    </div>
</div>
