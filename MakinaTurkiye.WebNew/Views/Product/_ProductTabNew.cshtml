@model MTProductTabModel
@using NeoSistem.MakinaTurkiye.Web.Models
@using NeoSistem.MakinaTurkiye.Web.Models.UtilityModel
@using NeoSistem.MakinaTurkiye.Core.Web.Helpers
@using System.Diagnostics
@using NeoSistem.MakinaTurkiye.Web.Models.Home
@using NeoSistem.MakinaTurkiye.Web.Models.MemberShip
@using NeoSistem.MakinaTurkiye.Web.Models.Authentication
@using MakinaTurkiye.Entities.Tables.Members
@using NeoSistem.MakinaTurkiye.Web.Models.ViewModels
@using NeoSistem.MakinaTurkiye.Web.Models.Products
@using NeoSistem.MakinaTurkiye.Web.Models.Catalog
@using System.Text.RegularExpressions;

@{
    // Layout = "~/Views/Shared/_LayoutAccountMaster.cshtml";
    //using NeoSistem.MakinaTurkiye.Web.Models
    //using NeoSistem.MakinaTurkiye.Web.Models.UtilityModel
}

@if (!string.IsNullOrEmpty(Model.ProductName))
{

    <div class="">
        <!-- URUN BILGI TAB ALAN -->

        <div class="urun-aciklama">
            <ul class="nav nav-tabs">
                <li class="active"><a data-toggle="tab" href="#aciklama">Açıklama</a></li>
                @*@if (Model.VideoModels.Count > 0)
                    {
                        <li><a data-toggle="tab" href="#video">Video</a></li>
                    }*@
                @if (!string.IsNullOrEmpty(Model.MapCode))
                {
                    <li id="map"><a data-toggle="tab" href="#konum">Konum</a></li>

                }
                @if (Model.MTProductTechnicalInfoItems.Count > 0)
                {

                    <li><a data-toggle="tab" href="#teknik">Teknik Bilgiler</a></li>
                }
                @if (Model.MTProductCatologs.Count > 0)
                {
                    <li><a data-toggle="tab" href="#catolog">Katalog</a></li>
                }
                <li><a data-toggle="tab" href="#comments">Yorumlar <span class="badge badge-info" style="background-color: #fc8120;">@Model.MTProductComment.TotalProductComment</span></a></li>
                @if (Model.Certificates.Count > 0)
                {
                    <li><a data-toggle="tab" href="#certificates">Sertifikalar <span class="badge badge-info" style="background-color: #fc8120;">@Model.Certificates.Count</span></a></li>

                }
            </ul>
            <div class="tab-content">
                <div id="aciklama" class="clearfix tab-pane fade in active">
                    <p>
                        @if (!string.IsNullOrWhiteSpace(Model.ProductDescription))
                        {
                            MakinaTurkiye.Core.Configuration.MakinaTurkiyeConfig config = MakinaTurkiye.Core.Infrastructure.EngineContext.Current.Resolve<MakinaTurkiye.Core.Configuration.MakinaTurkiyeConfig>();
                            string ProductDescriptionProcessResult = Model.ProductDescription;
                            if (config.ProductDescriptionHtmlClear)
                            {
                                //ProductDescriptionProcessResult = Regex.Replace(ProductDescriptionProcessResult, "(<style.+?</style>)|(<script.+?</script>)", "", RegexOptions.IgnoreCase | RegexOptions.Singleline);
                                //ProductDescriptionProcessResult = Regex.Replace(ProductDescriptionProcessResult, "(<img.+?>)", "", RegexOptions.IgnoreCase | RegexOptions.Singleline);
                                //ProductDescriptionProcessResult = Regex.Replace(ProductDescriptionProcessResult, "(<o:.+?</o:.+?>)", "", RegexOptions.IgnoreCase | RegexOptions.Singleline);
                                //ProductDescriptionProcessResult = Regex.Replace(ProductDescriptionProcessResult, "<!--.+?-->", "", RegexOptions.IgnoreCase | RegexOptions.Singleline);
                                //ProductDescriptionProcessResult = Regex.Replace(ProductDescriptionProcessResult, "class=.+?>", ">", RegexOptions.IgnoreCase | RegexOptions.Singleline);
                                ProductDescriptionProcessResult = Regex.Replace(ProductDescriptionProcessResult, "href=.+?>", ">", RegexOptions.IgnoreCase | RegexOptions.Singleline);
                                //ProductDescriptionProcessResult = Regex.Replace(ProductDescriptionProcessResult, "(line-height|font-family|font-size)\\s:.*?;?", String.Empty);
                                //ProductDescriptionProcessResult = Regex.Replace(ProductDescriptionProcessResult.Replace(System.Environment.NewLine, "<br/>"), "<[^(a|img|b|i|u|ul|ol|li)][^>]*>", " ");
                            }


                            @Html.Raw(ProductDescriptionProcessResult) }
                        else
                        { @("Bu ilana açıklama eklenmemiştir.")}
                    </p>
                    @Model.ProductSeoDescription

                    @if (Model.VideoModels.Count > 0)
                    {
                        <div id="video">
                            
                            <div class="row m0 p0 text-center">
                                <div id="video-slider"  data-interval="false" class="carousel slide col-md-8" data-ride="carousel">
                                    <div class="carousel-inner">

                                        @for (int i = 0; i < Model.VideoModels.Keys.Count; i++)
                                        {
                                            <div class="item @(i == 0 ? " active" : "")">
                                                @foreach (var item in Model.VideoModels[i])
                                                {
                                                    if (Model.VideoModels.Keys.Count >= 1)
                                                    {
                                                        <div class="col-xs-3 m0">
                                                            <div class="thumbnail thumbnail-mt">
                                                                <a class="js-video-slide-item" video-title="@item.VideoTitle" data-videoid="@item.VideoId" data-videopath="@item.VideoPath">
                                                                    <img src="@item.VideoPicturePath" alt="@item.VideoTitle" class="img-thumbnail" />
                                                                </a>
                                                            </div>
                                                        </div>
                                                    }
                                                }
                                            </div>
                                        }
                                    </div>

                                    @if (Model.VideoModels.Keys.Count > 1)
                                    {
                                        <a class="carousel-left" href="#video-slider" data-slide="prev"><span class="btn btn-sm glyphicon glyphicon-chevron-left"></span></a>
                                        <a class="carousel-right" href="#video-slider" data-slide="next"><span class="btn btn-sm glyphicon glyphicon-chevron-right"></span></a>
                                    }
                                </div>
                                <div class="videocontent col-md-8" style="margin-bottom:25px;">
                                    <div id="c-video-title" style="font-size:15px; font-weight:600;">@Model.VideoModels[0][0].VideoTitle</div>
                                    <video id="vd" class="video-js vjs-default-skin" controls preload="auto" width="100%" height="100%" style="padding: 4px; border: 1px solid #ddd; border-radius: 4px; transition: all .2s ease-in-out; display: inline-block;" poster="" data-setup='{"techOrder": ["html5", "flash"]}'>
                                        <source src="@Model.VideoModels[0][0].VideoPath" type='video/mp4' />
                                    </video>
                                </div>
                            </div>
                        </div>
                    }
                
                <div class="row">
                    <div class="col-md-12" style="font-size: 12px;">Bu ilan <b style="font-size: 14px;">@Model.ProductViewCount</b> kez incelenmiştir.</div>

                </div>

                </div>


                @if (!string.IsNullOrEmpty(Model.MapCode))
                {
                    <div id="konum" class="clearfix tab-pane fade">
                        <div style="width: 100%; overflow: hidden; height: 562px">
                            <input id="hiddenMapSrc" type="hidden" value="@(Model.MapCode)&amp;num=1&amp;ie=UTF8&amp;t=m&amp;z=14&amp;iwloc=A&amp;output=embed" />
                            <iframe id="mainMap" height="723" width="100%" frameborder="0" scrolling="no" marginheight="0"
                                    marginwidth="0" style="border: 0; margin-top: -150px;"></iframe>
                        </div>
                    </div>
                }
                @if (Model.MTProductTechnicalInfoItems.Count > 0)
                {
                    <div id="teknik" class="clearfix tab-pane fade" style="font-size: 15px;">
                        @foreach (var item in Model.MTProductTechnicalInfoItems.ToList())
                        {
                            <div class="col-md-4">
                                <span style="color: #ccc;" class="glyphicon glyphicon-check"></span><b>@item.DisplayName</b>@item.Value
                            </div>
                        }
                    </div>
                }
                @if (Model.MTProductCatologs.Count > 0)
                {
                    <div id="catolog" class="clearfix tab-pane fade" style="font-size: 15px;">
                        <div style="width: 100%; overflow: hidden; height: 562px">

                            <div class="row">
                                @foreach (var item in Model.MTProductCatologs)
                                {
                                    <div class="col-xs-4 col-md-3">
                                        <div class="thumbnail thumbnail-mt">
                                            <a target="_blank" href="@item.FilePath" class="pdf-icon-link">
                                                <img class="pdf-icon" src="/Content/V2/images/pdf-icon.png" />
                                            </a>
                                            <div class="caption-pdf">
                                                @Model.ProductName
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>

                }
                <div id="comments" class="clearfix tab-pane fade" style="font-size: 15px;">
                    @{Html.RenderPartial("_ProductComment", Model);}
                </div>
                @if (Model.Certificates.Count > 0)
                {
                    <div id="certificates" class="clearfix tab-pane fade" style="font-size: 15px;">
                        <div class="row">
                            <div class="col-md-12 certificate-popup-gallery">

                                @foreach (var entry in Model.Certificates)
                                {
                                    <div class="col-md-3">
                                        <div style="height: 280px;">
                                            <a class="img-cerficate-link" href="@entry.File.Replace(" -500x800","_certificate")" title="@entry.File">
                                                <img class="img-responsive" style="border: 1px solid #ccc; height: 100%; -webkit-box-shadow: -2px 4px 7px -3px #000000; box-shadow: -2px 4px 7px -3px #000000;" src="@entry.File.Replace(" png","jpg")" alt="@entry.Name" />
                                            </a>
                                        </div>
                                        <p style="font-size: 14px; margin-top: 5px;">@entry.Name</p>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>


}
